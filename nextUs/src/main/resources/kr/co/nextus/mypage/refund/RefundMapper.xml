<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.nextus.mypage.refund.RefundMapper">
	
	<!-- 신고 등록 -->
	<insert id="insert" parameterType="kr.co.nextus.mypage.refund.RefundVO">
		INSERT INTO REFUND (
			buyno, content, refund_amount, date
		) VALUES (
			#{buyno}, #{content}, #{refund_amount}, NOW()
		);
	</insert>
	
	<update id="update" parameterType="kr.co.nextus.mypage.refund.RefundVO">
		UPDATE BUYLIST SET 
			status=2
		WHERE buyno=#{buyno};
	</update>
	
	
	<!-- 리스트 -->
	<select id="list" parameterType="kr.co.nextus.mypage.refund.RefundVO"
		resultType="kr.co.nextus.mypage.refund.RefundVO">
		SELECT r.*, m.email
		FROM REFUND r
		JOIN BUYLIST b ON r.buyno = b.buyno
		JOIN MEMBER m ON b.memberno = m.no
		ORDER BY r.state DESC, r.date ASC
		LIMIT #{startIdx}, 10
	</select>
	<!-- 카운트 -->
	<select id="count" parameterType="kr.co.nextus.mypage.refund.RefundVO"
		resultType="int">
		SELECT COUNT(*) FROM REFUND
	</select>
</mapper>   